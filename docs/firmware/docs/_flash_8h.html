<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ADI iSensor FX3 Firmware: C:/Users/anolan3/Documents/iSensor-FX3-API/firmware/FX3_Firmware/Flash.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Analog-Devices-Logo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ADI iSensor FX3 Firmware
   &#160;<span id="projectnumber">v2.9.2-pub</span>
   </div>
   <div id="projectbrief">Firmware for the Analog Devices EVAL-ADIS-FX3 IMU Evaluation Platform. This firmware can be compiled using the Cypress EZ USB Suite IDE</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_a6f5bf3126ac94fe2cad71d1f6aa3d6b.html">FX3_Firmware</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Flash.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Header file for FX3 flash interfacing module.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;cyu3dma.h&quot;</code><br />
<code>#include &quot;cyu3error.h&quot;</code><br />
<code>#include &quot;cyu3i2c.h&quot;</code><br />
<code>#include &quot;<a class="el" href="main_8h_source.html">main.h</a>&quot;</code><br />
</div>
<p><a href="_flash_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a4cc14e2c99ae7f8e5a8e371d03c8532c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_flash_8h.html#a4cc14e2c99ae7f8e5a8e371d03c8532c">FLASH_PAGE_SIZE</a>&#160;&#160;&#160;0x40</td></tr>
<tr class="separator:a4cc14e2c99ae7f8e5a8e371d03c8532c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e35814490c8f20d26577568f0355266"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_flash_8h.html#a5e35814490c8f20d26577568f0355266">FLASH_TIMEOUT_MS</a>&#160;&#160;&#160;5000</td></tr>
<tr class="separator:a5e35814490c8f20d26577568f0355266"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a040d4f474a0b1a17b0bd9d4ff3b19cc2"><td class="memItemLeft" align="right" valign="top">CyU3PReturnStatus_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_flash_8h.html#a040d4f474a0b1a17b0bd9d4ff3b19cc2">AdiFlashInit</a> ()</td></tr>
<tr class="memdesc:a040d4f474a0b1a17b0bd9d4ff3b19cc2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes flash memory interface module.  <a href="_flash_8h.html#a040d4f474a0b1a17b0bd9d4ff3b19cc2">More...</a><br /></td></tr>
<tr class="separator:a040d4f474a0b1a17b0bd9d4ff3b19cc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5bad5719afeea09ceec372cff5625e61"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_flash_8h.html#a5bad5719afeea09ceec372cff5625e61">AdiFlashDeInit</a> ()</td></tr>
<tr class="memdesc:a5bad5719afeea09ceec372cff5625e61"><td class="mdescLeft">&#160;</td><td class="mdescRight">De-init the flash memory interfacing module.  <a href="_flash_8h.html#a5bad5719afeea09ceec372cff5625e61">More...</a><br /></td></tr>
<tr class="separator:a5bad5719afeea09ceec372cff5625e61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32675702d0694877caab6548579ba64b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_flash_8h.html#a32675702d0694877caab6548579ba64b">AdiFlashWrite</a> (uint32_t Address, uint16_t NumBytes, uint8_t *WriteBuf)</td></tr>
<tr class="memdesc:a32675702d0694877caab6548579ba64b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write a block of memory to flash, at the specified byte address.  <a href="_flash_8h.html#a32675702d0694877caab6548579ba64b">More...</a><br /></td></tr>
<tr class="separator:a32675702d0694877caab6548579ba64b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a763f7a7edcdf1e42756f7107ebe7121e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_flash_8h.html#a763f7a7edcdf1e42756f7107ebe7121e">AdiFlashRead</a> (uint32_t Address, uint16_t NumBytes, uint8_t *ReadBuf)</td></tr>
<tr class="memdesc:a763f7a7edcdf1e42756f7107ebe7121e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read a block of memory from flash, at the specified byte address.  <a href="_flash_8h.html#a763f7a7edcdf1e42756f7107ebe7121e">More...</a><br /></td></tr>
<tr class="separator:a763f7a7edcdf1e42756f7107ebe7121e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb56618b5a5d3c6bdedcc29cac560463"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_flash_8h.html#afb56618b5a5d3c6bdedcc29cac560463">AdiFlashReadHandler</a> (uint32_t Address, uint16_t NumBytes)</td></tr>
<tr class="memdesc:afb56618b5a5d3c6bdedcc29cac560463"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles flash read requests from control endpoint.  <a href="_flash_8h.html#afb56618b5a5d3c6bdedcc29cac560463">More...</a><br /></td></tr>
<tr class="separator:afb56618b5a5d3c6bdedcc29cac560463"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Header file for FX3 flash interfacing module. </p>
<p>Copyright (c) Analog Devices Inc, 2018 - 2020 All Rights Reserved.</p>
<p>THIS SOFTWARE UTILIZES LIBRARIES DEVELOPED AND MAINTAINED BY CYPRESS INC. THE LICENSE INCLUDED IN THIS REPOSITORY DOES NOT EXTEND TO CYPRESS PROPERTY.</p>
<p>Use of this file is governed by the license agreement included in this repository.</p>
<dl class="section date"><dt>Date</dt><dd>04/30/2020 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>A. Nolan (<a href="#" onclick="location.href='mai'+'lto:'+'ale'+'x.'+'nol'+'an'+'@an'+'al'+'og.'+'co'+'m'; return false;">alex.<span style="display: none;">.nosp@m.</span>nola<span style="display: none;">.nosp@m.</span>n@ana<span style="display: none;">.nosp@m.</span>log.<span style="display: none;">.nosp@m.</span>com</a>) </dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a4cc14e2c99ae7f8e5a8e371d03c8532c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4cc14e2c99ae7f8e5a8e371d03c8532c">&#9670;&nbsp;</a></span>FLASH_PAGE_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FLASH_PAGE_SIZE&#160;&#160;&#160;0x40</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Page size for attached i2c flash memory (64 bytes) <br  />
 </p>

</div>
</div>
<a id="a5e35814490c8f20d26577568f0355266"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e35814490c8f20d26577568f0355266">&#9670;&nbsp;</a></span>FLASH_TIMEOUT_MS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FLASH_TIMEOUT_MS&#160;&#160;&#160;5000</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Flash operation timeout <br  />
 </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a5bad5719afeea09ceec372cff5625e61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5bad5719afeea09ceec372cff5625e61">&#9670;&nbsp;</a></span>AdiFlashDeInit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AdiFlashDeInit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>De-init the flash memory interfacing module. </p>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>This functions destroys the DMA channels used for interfacing with the I2C module, and re-inits the I2C controller to operate in register mode, with the previously selected bitrate. </p>

</div>
</div>
<a id="a040d4f474a0b1a17b0bd9d4ff3b19cc2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a040d4f474a0b1a17b0bd9d4ff3b19cc2">&#9670;&nbsp;</a></span>AdiFlashInit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CyU3PReturnStatus_t AdiFlashInit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes flash memory interface module. </p>
<dl class="section return"><dt>Returns</dt><dd>Status code indication the success of the flash init operation</dd></dl>
<p>The FX3 board features a ST m24m02-dr I2C EEPROM. This function initializes the FX3 I2C block to operate in DMA mode with the max supported I2C clock. It then configures the I2C Rx and Tx channels to perform a transfer </p>

</div>
</div>
<a id="a763f7a7edcdf1e42756f7107ebe7121e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a763f7a7edcdf1e42756f7107ebe7121e">&#9670;&nbsp;</a></span>AdiFlashRead()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AdiFlashRead </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>Address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>NumBytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>ReadBuf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read a block of memory from flash, at the specified byte address. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Address</td><td>The start address (in flash) to perform the read operation from</td></tr>
    <tr><td class="paramname">NumBytes</td><td>The number of bytes to read from the flash</td></tr>
    <tr><td class="paramname">ReadBuf</td><td>RAM buffer to read flash data into</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>This function leaves the I2C EEPROM write functionality disabled. This prevents inadvertent writes from being processed. </p>

</div>
</div>
<a id="afb56618b5a5d3c6bdedcc29cac560463"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb56618b5a5d3c6bdedcc29cac560463">&#9670;&nbsp;</a></span>AdiFlashReadHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AdiFlashReadHandler </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>Address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>NumBytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles flash read requests from control endpoint. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Address</td><td>The byte address in flash to start reading at</td></tr>
    <tr><td class="paramname">NumBytes</td><td>The number of bytes to read. Max 4KB</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>The data read from flash is returned over the control endpoint. This limits a single read to 4KB. If greater than a 4KB read is needed, multiple transactions should be sent. Managing this limit is left to the higher level software sending USB commands. </p>

</div>
</div>
<a id="a32675702d0694877caab6548579ba64b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32675702d0694877caab6548579ba64b">&#9670;&nbsp;</a></span>AdiFlashWrite()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AdiFlashWrite </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>Address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>NumBytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>WriteBuf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write a block of memory to flash, at the specified byte address. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Address</td><td>The start address (in flash) to perform the write operation to</td></tr>
    <tr><td class="paramname">NumBytes</td><td>The number of bytes to write to flash</td></tr>
    <tr><td class="paramname">WriteBuf</td><td>RAM buffer containing data to be written to flash</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>This function controls the flash write enable signal. This write enable signal is used to prevent un-intended writes the flash from user space, via I2C functions. This write enable signal is only present on the iSensor FX3 board rev C or newer, but there shouldn't be any downside to asserting it on older hardware models. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
