<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ADI iSensor FX3 Firmware: C:/Users/anolan3/Documents/iSensor-FX3-API/firmware/FX3_Firmware/ErrorLog.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Analog-Devices-Logo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ADI iSensor FX3 Firmware
   &#160;<span id="projectnumber">v2.9.2-pub</span>
   </div>
   <div id="projectbrief">Firmware for the Analog Devices EVAL-ADIS-FX3 IMU Evaluation Platform. This firmware can be compiled using the Cypress EZ USB Suite IDE</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_a6f5bf3126ac94fe2cad71d1f6aa3d6b.html">FX3_Firmware</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">ErrorLog.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implementation file for FX3 flash error logging module.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="_error_log_8h_source.html">ErrorLog.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac2def3369d7999ab5c58dce043eccfb7"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_error_log_8c.html#ac2def3369d7999ab5c58dce043eccfb7">FindFirmwareVersion</a> (uint8_t *outBuf)</td></tr>
<tr class="memdesc:ac2def3369d7999ab5c58dce043eccfb7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parses the firmware version number from FirmwareID to a user provided buffer.  <a href="_error_log_8c.html#ac2def3369d7999ab5c58dce043eccfb7">More...</a><br /></td></tr>
<tr class="separator:ac2def3369d7999ab5c58dce043eccfb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a94a7492bbf8dd7454a4abf2ed3b26f1c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_error_log_8c.html#a94a7492bbf8dd7454a4abf2ed3b26f1c">WriteLogToFlash</a> (<a class="el" href="struct_error_msg.html">ErrorMsg</a> *msg)</td></tr>
<tr class="memdesc:a94a7492bbf8dd7454a4abf2ed3b26f1c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes a log data structure to flash memory.  <a href="_error_log_8c.html#a94a7492bbf8dd7454a4abf2ed3b26f1c">More...</a><br /></td></tr>
<tr class="separator:a94a7492bbf8dd7454a4abf2ed3b26f1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa25d266c44a3f98d1ed22181cef2b4f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_error_log_8c.html#afa25d266c44a3f98d1ed22181cef2b4f">WriteLogToDebug</a> (<a class="el" href="struct_error_msg.html">ErrorMsg</a> *msg)</td></tr>
<tr class="memdesc:afa25d266c44a3f98d1ed22181cef2b4f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints an error log object to the debug console.  <a href="_error_log_8c.html#afa25d266c44a3f98d1ed22181cef2b4f">More...</a><br /></td></tr>
<tr class="separator:afa25d266c44a3f98d1ed22181cef2b4f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af872f4a84993f70c2a961fe793fd2d65"><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_error_log_8c.html#af872f4a84993f70c2a961fe793fd2d65">GetNewLogAddress</a> (uint32_t *TotalLogCount)</td></tr>
<tr class="memdesc:af872f4a84993f70c2a961fe793fd2d65"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets address (in flash memory) for a new error log entry.  <a href="_error_log_8c.html#af872f4a84993f70c2a961fe793fd2d65">More...</a><br /></td></tr>
<tr class="separator:af872f4a84993f70c2a961fe793fd2d65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2712cdc1e255d23690632841b58d21f6"><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_error_log_8c.html#a2712cdc1e255d23690632841b58d21f6">GetLogCount</a> ()</td></tr>
<tr class="memdesc:a2712cdc1e255d23690632841b58d21f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the log count from flash.  <a href="_error_log_8c.html#a2712cdc1e255d23690632841b58d21f6">More...</a><br /></td></tr>
<tr class="separator:a2712cdc1e255d23690632841b58d21f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56fa922a54ca2e52be68f8b4bd4f29ca"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_error_log_8c.html#a56fa922a54ca2e52be68f8b4bd4f29ca">AdiLogError</a> (<a class="el" href="_error_log_8h.html#a961bfce4003ed3e90785c485090db4f7">FileIdentifier</a> File, uint32_t Line, uint32_t ErrorCode)</td></tr>
<tr class="memdesc:a56fa922a54ca2e52be68f8b4bd4f29ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Logs a firmware error to flash memory for later examination.  <a href="_error_log_8c.html#a56fa922a54ca2e52be68f8b4bd4f29ca">More...</a><br /></td></tr>
<tr class="separator:a56fa922a54ca2e52be68f8b4bd4f29ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92e80f7bc3d347c7df859cd9867c8ed1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_error_log_8c.html#a92e80f7bc3d347c7df859cd9867c8ed1">WriteErrorLogCount</a> (uint32_t count)</td></tr>
<tr class="memdesc:a92e80f7bc3d347c7df859cd9867c8ed1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the error log count value in flash.  <a href="_error_log_8c.html#a92e80f7bc3d347c7df859cd9867c8ed1">More...</a><br /></td></tr>
<tr class="separator:a92e80f7bc3d347c7df859cd9867c8ed1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aadb5735a48942c795b3be33a17c14eb4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_board_state.html">BoardState</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_error_log_8c.html#aadb5735a48942c795b3be33a17c14eb4">FX3State</a></td></tr>
<tr class="separator:aadb5735a48942c795b3be33a17c14eb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9e4e98db027290327cded5732a7ed2a"><td class="memItemLeft" align="right" valign="top"><a id="af9e4e98db027290327cded5732a7ed2a"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>FirmwareID</b> [32]</td></tr>
<tr class="separator:af9e4e98db027290327cded5732a7ed2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cd2b15d95a6ccbae328ed6b84606f78"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_error_log_8c.html#a0cd2b15d95a6ccbae328ed6b84606f78">LogBuffer</a> [<a class="el" href="_flash_8h.html#a4cc14e2c99ae7f8e5a8e371d03c8532c">FLASH_PAGE_SIZE</a>]</td></tr>
<tr class="separator:a0cd2b15d95a6ccbae328ed6b84606f78"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation file for FX3 flash error logging module. </p>
<p>Copyright (c) Analog Devices Inc, 2018 - 2020 All Rights Reserved.</p>
<p>THIS SOFTWARE UTILIZES LIBRARIES DEVELOPED AND MAINTAINED BY CYPRESS INC. THE LICENSE INCLUDED IN THIS REPOSITORY DOES NOT EXTEND TO CYPRESS PROPERTY.</p>
<p>Use of this file is governed by the license agreement included in this repository.</p>
<dl class="section date"><dt>Date</dt><dd>12/6/2019 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>A. Nolan (<a href="#" onclick="location.href='mai'+'lto:'+'ale'+'x.'+'nol'+'an'+'@an'+'al'+'og.'+'co'+'m'; return false;">alex.<span style="display: none;">.nosp@m.</span>nola<span style="display: none;">.nosp@m.</span>n@ana<span style="display: none;">.nosp@m.</span>log.<span style="display: none;">.nosp@m.</span>com</a>) </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a56fa922a54ca2e52be68f8b4bd4f29ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a56fa922a54ca2e52be68f8b4bd4f29ca">&#9670;&nbsp;</a></span>AdiLogError()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AdiLogError </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_error_log_8h.html#a961bfce4003ed3e90785c485090db4f7">FileIdentifier</a>&#160;</td>
          <td class="paramname"><em>File</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>Line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ErrorCode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Logs a firmware error to flash memory for later examination. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">File</td><td>The file which produced the error</td></tr>
    <tr><td class="paramname">Line</td><td>The line in the source file which produced the error</td></tr>
    <tr><td class="paramname">ErrorCode</td><td>The error code which produced the error. Should be of type CyU3PReturnStatus_t.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>When calling this function, the Line parameter should be generated by the C pre-processor using the <b>LINE</b> macro. Internally, this function sets the unit boot time stamp (FX3 boot time), system uptime based on the FX3 RTOS tick clock, and the FX3 firmware version before logging the error to both the debugger output (serial port) and flash memory. </p>

</div>
</div>
<a id="ac2def3369d7999ab5c58dce043eccfb7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2def3369d7999ab5c58dce043eccfb7">&#9670;&nbsp;</a></span>FindFirmwareVersion()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void FindFirmwareVersion </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>outBuf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parses the firmware version number from FirmwareID to a user provided buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">outBuf</td><td>The buffer to place the firmware version into</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>This function uses a fixed offset to get the version number from the FirmwareID string. This fixed offset works for current and past versions of the FirmwareID, but will break if the ID format is changed. </p>

</div>
</div>
<a id="a2712cdc1e255d23690632841b58d21f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2712cdc1e255d23690632841b58d21f6">&#9670;&nbsp;</a></span>GetLogCount()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint32_t GetLogCount </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets the log count from flash. </p>
<dl class="section return"><dt>Returns</dt><dd>The current logged error count (from LOG_COUNT) </dd></dl>

</div>
</div>
<a id="af872f4a84993f70c2a961fe793fd2d65"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af872f4a84993f70c2a961fe793fd2d65">&#9670;&nbsp;</a></span>GetNewLogAddress()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint32_t GetNewLogAddress </td>
          <td>(</td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>TotalLogCount</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets address (in flash memory) for a new error log entry. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">TotalLogCount</td><td>Return by reference for the total number of error log entries stored in flash</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The flash address of the new error log entry</dd></dl>
<p>This function implements the error log circular buffer logic by mod-ing the count with the capacity (newer entries will overwrite the oldest error log once the buffer is full). </p>

</div>
</div>
<a id="a92e80f7bc3d347c7df859cd9867c8ed1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92e80f7bc3d347c7df859cd9867c8ed1">&#9670;&nbsp;</a></span>WriteErrorLogCount()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void WriteErrorLogCount </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>count</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the error log count value in flash. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">count</td><td>The new error log count value to write to flash</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="afa25d266c44a3f98d1ed22181cef2b4f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa25d266c44a3f98d1ed22181cef2b4f">&#9670;&nbsp;</a></span>WriteLogToDebug()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void WriteLogToDebug </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_error_msg.html">ErrorMsg</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Prints an error log object to the debug console. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The error log object to print</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="a94a7492bbf8dd7454a4abf2ed3b26f1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a94a7492bbf8dd7454a4abf2ed3b26f1c">&#9670;&nbsp;</a></span>WriteLogToFlash()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void WriteLogToFlash </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_error_msg.html">ErrorMsg</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Writes a log data structure to flash memory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The error log object to write</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>This function first gets the address for the new buffer entry from the flash error log ring buffer. It then clears the 32 bytes which have been allocated in flash for the current error log. The passed log is then copied byte-wise into the LogBuffer, array, then written to flash. Finally, the LOG_COUNT variable in flash is incremented. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="aadb5735a48942c795b3be33a17c14eb4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aadb5735a48942c795b3be33a17c14eb4">&#9670;&nbsp;</a></span>FX3State</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_board_state.html">BoardState</a> FX3State</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Struct. which stores all run time configurable FX3 settings </p>

</div>
</div>
<a id="a0cd2b15d95a6ccbae328ed6b84606f78"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0cd2b15d95a6ccbae328ed6b84606f78">&#9670;&nbsp;</a></span>LogBuffer</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t LogBuffer[<a class="el" href="_flash_8h.html#a4cc14e2c99ae7f8e5a8e371d03c8532c">FLASH_PAGE_SIZE</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Error log buffer. Each error log entry is copied here before being written to flash </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
